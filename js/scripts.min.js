function GameUi(){self.onSpin;self.onIncreaseCurrentBet;self.onDecreaseCurrentBet;var t;var e=this;var n;var i;var o;this.create=function(){s();r();a();c()};function r(){i=document.createElement("div");i.className="score-label";for(var t=0;t<7;t++){var e=document.createElement("div");e.className="entry";i.appendChild(e)}helper.addToStage(i)}function s(){o=document.createElement("button");o.className="spin-button";o.onclick=function(){e.onSpin()};helper.addToStage(o)}function a(){const t=document.createElement("div");t.className="logo";helper.addToStage(t)}function c(){n=document.createElement("div");n.className="multiplier";$(n).hide();helper.addToStage(n)}this.showMultiplierLabel=function(t){n.innerHTML="<p>"+t+"<span>x</span></p>";$(n).css("transform","scale(0, 0)");$(n).show();$({s:0}).animate({s:1},{duration:1e3,easing:"easeOutElastic",step:function(t){$(n).css("transform","scale("+t+", "+t+")")},complete:function(){setTimeout(function(){u()},1e3)}})};function u(){$({s:1}).animate({s:0},{duration:100,easing:"linear",step:function(t){$(n).css("transform","scale("+t+", "+t+")")},complete:function(){$(n).hide()}})}this.toggleSpinButton=function(){o.disabled=!o.disabled};this.toggleStop=function(){$(o).toggleClass("spinning")};this.updateScoreLabel=function(t,e){$({s:t}).animate({s:e},{duration:"slow",step:function(t){l(t.toFixed(0))}})};function l(t){const e=t.toString().reverse();const n=$(i).find(".entry");for(var o=0;o<n.length;o++){if(o<e.length){n[o].innerHTML=e[o]}else{n[o].innerHTML="0"}}}return this}const helper=new Helper;const game=new Game;function Game(){const t=3;var e=new SlotMachine(t);var n=new GameUi;var i=false;var o=false;var r=0;var s=0;const a=100;this.init=function(){PIXI.loader.add(helper.createSlotTypeFileNameArray(Slots)).add("images/machine.png").add("images/number.png").add("images/logo.png").add("images/btn-spin.png").add("images/btn-stop.png").on("progress",c).load(h);container.appendChild(renderer.view);requestAnimationFrame(p)};function c(t){}function u(){if(i&&o){e.stopSpin();return}if(i)return;i=true;o=false;e.spin(l);n.toggleSpinButton()}function l(t){if(t){s++;var e=r+s*a;g(e);n.showMultiplierLabel(s)}else{g(0);s=0}i=false;n.toggleStop();n.toggleSpinButton()}function p(){requestAnimationFrame(p);e.update();renderer.render(stage)}function h(){e.onAllowStop=f;e.onAllReelsStopped=d;e.create();n.create();n.onSpin=u;g(0)}function f(){o=true;n.toggleStop();n.toggleSpinButton()}function d(){n.toggleSpinButton()}function g(t){const e=r;r=t;n.updateScoreLabel(e,t)}}function GameResult(){this.calculateResult=function(t){var e=null;for(var n=0;n<t.length;n++){if(e){if(t[n].type!==e)return false}else{e=t[n].type}}return true}}const backgroundWidth=800;const backgroundHeight=600;const stage=new PIXI.Container,renderer=PIXI.autoDetectRenderer(backgroundWidth,backgroundHeight);const Slots=["cat","fox","dog","penguin","bear"];function Helper(){this.addToScene=function(t){stage.addChild(t)};this.addToStage=function(t){container.appendChild(t)};this.removeFromScene=function(t){stage.removeChild(t)};this.createSquare=function(t,e,n,i){var o=new PIXI.Graphics;o.beginFill();o.drawRect(t,e,n,i);o.endFill();return o};this.createRoundSquare=function(t,e,n,i,o){var r=new PIXI.Graphics;r.beginFill();r.drawRoundedRect(t,e,n,i,o);r.endFill();return r};this.parentCenter=function(t){t.pivot=new PIXI.Point(t.width/2,t.height/2);return t};this.createCircle=function(t,e,n){var i=new PIXI.Graphics;i.beginFill("#000");i.drawCircle(t,e,n);i.endFill();return i};this.createSlotTypeFileNameArray=function(t){var e=[];$.each(t,function(t,n){e.push(helper.getSlotTypeFileName(n))});return e};this.getSlotTypeFileName=function(t){return"images/"+t+".png"};this.createLabeledRoundButton=function(t,e,n,i,o){const r=new PIXI.Text(t,{font:"50px Arial",fill:"white"});const s=helper.createCircle(0,0,i).setInteractive(true);s.position={x:e,y:n};s.on("mouseup",o);s.on("touchend",o);s.addChild(r);this.parentCenter(r);return s}}Array.prototype.contains=function(t){var e=this.length;while(e--)if(this[e]===t)return true;return false};Array.prototype.last=function(){return this[this.length-1]};Array.prototype.first=function(){return this[0]};PIXI.Graphics.prototype.setInteractive=function(t){this.interactive=t;return this};String.prototype.reverse=function(){return this.split("").reverse().join("")};function Reel(t,e,n){this.id=e;var i=false;var o=this.id%2==0;const r=[];var s=0;const a=300;const c=-90-a;const u=380/3;const l=155+this.id*u;var p=0;const h=30;const f=500;this.readyToStop;this.finishedSpin;const d=this;Reel.prototype.create=function(){for(var e=0;e<t;e++){var i=new Slot(Slots[e%Slots.length],n,this.id);i.create();r.push(i);helper.addToScene(i.sprite)}g()};function g(){$.each(r,function(t,e){e.sprite.position.y=l;e.sprite.position.x=s+c+t*a})}this.spin=function(){if(!i)return;S(p)};this.startSpinning=function(){i=true;var t=this;$({speed:0}).animate({speed:h},{duration:f,step:function(t){p=t},complete:function(){if(t.readyToStop!=null)t.readyToStop()}})};function S(t){$.each(r,function(e,n){n.sprite.position.x=o?n.sprite.position.x-t:n.sprite.position.x+t});s=o?s-t:s+t;if(Math.abs(s)>=a)m()}function m(){var t;if(o){t=r.first();r.splice(0,1);r.push(t)}else{t=r.last();r.pop();r.splice(0,0,t)}s=o?s+a:s-a;t.sprite.position.x=o?r[r.length-2].sprite.position.x+a:r[1].sprite.position.x-a}this.endSpin=function(){i=false;var t=p;$({speed:0}).animate({speed:t},{duration:f*3,step:function(e){S(t-e)},complete:function(){v()}})};function v(){const t=Math.abs(s)>a/2;const e=s;const n=t?s>=0?a:a*-1:0;$({x:e}).animate({x:n},{duration:f*2,easing:"easeOutElastic",step:function(t){s=t;g()},complete:function(){if(t)m();if(d.finishedSpin)d.finishedSpin()}})}this.getResult=function(){return r[2]};return this}function Slot(t,e,n){this.type=t;const i=helper.getSlotTypeFileName(this.type);const o=backgroundHeight*.6333333;this.create=function(){var t=PIXI.loader.resources[i].texture;var r=new PIXI.Rectangle(0,n*(t.height/3),t.width,t.height/3);var s=new PIXI.Texture(t,r);this.sprite=new PIXI.Sprite(s);this.sprite.width=o;this.sprite.height=o/3;this.sprite.anchor.set(0,0);this.sprite.mask=e};return this}function SlotMachine(t){const e=[];const n=5;const i="images/machine.png";const o=300;const r=new GameResult;var s;var a=false;var c=0;this.onAllowStop;this.onAllReelsStopped;const u=this;this.create=function(){l();const t=p();h(t);f()};this.update=function(){$.each(e,function(t,e){e.spin()})};function l(){var t=new PIXI.Sprite(PIXI.loader.resources[i].texture);t.width=backgroundWidth;t.height=backgroundHeight;helper.addToScene(t)}function p(){var t=helper.createRoundSquare(47,0,backgroundWidth-47*2,430,40);t.position.y=110;helper.addToScene(t);return t}function h(i){for(var o=0;o<t;o++){var r=new Reel(n,o,i);r.create();e.push(r)}}function f(){e.last().readyToStop=function(){if(u.onAllowStop)u.onAllowStop()};e.last().finishedSpin=S}this.spin=function(t){if(a)return;c=0;s=t;a=true;$.each(e,function(t,e){d(e,t)})};function d(t,e){setTimeout(function(){t.startSpinning()},e*o)}this.stopSpin=function(){if(c==t)return;g(e[c++]);if(c==t)this.onAllReelsStopped()};function g(t){t.endSpin()}function S(){const t=[];$.each(e,function(e,n){t.push(n.getResult())});a=false;s(r.calculateResult(t))}return this}
