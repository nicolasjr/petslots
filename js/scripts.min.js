function GameUi(){self.onSpin;self.onIncreaseCurrentBet;self.onDecreaseCurrentBet;var e;var t=this;var n;var i;this.create=function(){o();r();s();a()};function r(){i=document.createElement("div");i.className="score-label";for(var e=0;e<7;e++){var t=document.createElement("div");t.className="entry";i.appendChild(t)}helper.addToStage(i)}function o(){const e=document.createElement("button");e.className="spin-button";e.onclick=function(){t.onSpin()};helper.addToStage(e)}function s(){const e=document.createElement("div");e.className="logo";helper.addToStage(e)}function a(){n=document.createElement("div");n.className="multiplier";$(n).hide();helper.addToStage(n)}this.showMultiplierLabel=function(e){n.innerHTML="<p>"+e+"<span>x</span></p>";$(n).css("transform","scale(0, 0)");$(n).show();$({s:0}).animate({s:1},{duration:1e3,easing:"easeOutElastic",step:function(e){$(n).css("transform","scale("+e+", "+e+")")},complete:function(){setTimeout(function(){c()},1e3)}})};function c(){$({s:1}).animate({s:0},{duration:100,easing:"linear",step:function(e){$(n).css("transform","scale("+e+", "+e+")")},complete:function(){$(n).hide()}})}this.updateScoreLabel=function(e,t){$({s:e}).animate({s:t},{duration:"slow",step:function(e){u(e.toFixed(0))}})};function u(e){const t=e.toString().reverse();const n=$(i).find(".entry");for(var r=0;r<n.length;r++){if(r<t.length){n[r].innerHTML=t[r]}else{n[r].innerHTML="0"}}}return this}const helper=new Helper;const game=new Game;function Game(){const e=3;var t=new SlotMachine(e);var n=new GameUi;var i=false;var r=false;var o=0;var s=0;const a=100;this.init=function(){PIXI.loader.add(helper.createSlotTypeFileNameArray(Slots)).add("images/machine.png").on("progress",c).load(h);container.appendChild(renderer.view);requestAnimationFrame(p)};function c(e){}function u(){if(i&&r){t.stopSpin();return}if(i)return;i=true;r=false;t.spin(l)}function l(e){if(e){s++;var t=o+s*a;d(t);n.showMultiplierLabel(s)}else{d(0);s=0}i=false}function p(){requestAnimationFrame(p);t.update();renderer.render(stage)}function h(){t.onAllowStop=f;t.create();n.create();n.onSpin=u;d(0)}function f(){r=true}function d(e){const t=o;o=e;n.updateScoreLabel(t,e)}}function GameResult(){this.calculateResult=function(e){var t=null;for(var n=0;n<e.length;n++){if(t){if(e[n].type!==t)return false}else{t=e[n].type}}return true}}const backgroundWidth=800;const backgroundHeight=600;const stage=new PIXI.Container,renderer=PIXI.autoDetectRenderer(backgroundWidth,backgroundHeight);const Slots=["cat","fox","dog","penguin","bear"];function Helper(){this.addToScene=function(e){stage.addChild(e)};this.addToStage=function(e){container.appendChild(e)};this.removeFromScene=function(e){stage.removeChild(e)};this.createSquare=function(e,t,n,i){var r=new PIXI.Graphics;r.beginFill();r.drawRect(e,t,n,i);r.endFill();return r};this.createRoundSquare=function(e,t,n,i,r){var o=new PIXI.Graphics;o.beginFill();o.drawRoundedRect(e,t,n,i,r);o.endFill();return o};this.parentCenter=function(e){e.pivot=new PIXI.Point(e.width/2,e.height/2);return e};this.createCircle=function(e,t,n){var i=new PIXI.Graphics;i.beginFill("#000");i.drawCircle(e,t,n);i.endFill();return i};this.createSlotTypeFileNameArray=function(e){var t=[];$.each(e,function(e,n){t.push(helper.getSlotTypeFileName(n))});return t};this.getSlotTypeFileName=function(e){return"images/"+e+".png"};this.createLabeledRoundButton=function(e,t,n,i,r){const o=new PIXI.Text(e,{font:"50px Arial",fill:"white"});const s=helper.createCircle(0,0,i).setInteractive(true);s.position={x:t,y:n};s.on("mouseup",r);s.on("touchend",r);s.addChild(o);this.parentCenter(o);return s}}Array.prototype.contains=function(e){var t=this.length;while(t--)if(this[t]===e)return true;return false};Array.prototype.last=function(){return this[this.length-1]};Array.prototype.first=function(){return this[0]};PIXI.Graphics.prototype.setInteractive=function(e){this.interactive=e;return this};String.prototype.reverse=function(){return this.split("").reverse().join("")};function Reel(e,t,n){this.id=t;var i=false;var r=this.id%2==0;const o=[];var s=0;const a=300;const c=-90-a;const u=380/3;const l=155+this.id*u;var p=0;const h=30;const f=500;this.readyToStop;this.finishedSpin;const d=this;Reel.prototype.create=function(){for(var t=0;t<e;t++){var i=new Slot(Slots[t%Slots.length],n,this.id);i.create();o.push(i);helper.addToScene(i.sprite)}g()};function g(){$.each(o,function(e,t){t.sprite.position.y=l;t.sprite.position.x=s+c+e*a})}this.spin=function(){if(!i)return;m(p)};this.startSpinning=function(){i=true;var e=this;$({speed:0}).animate({speed:h},{duration:f,step:function(e){p=e},complete:function(){if(e.readyToStop!=null)e.readyToStop()}})};function m(e){$.each(o,function(t,n){n.sprite.position.x=r?n.sprite.position.x-e:n.sprite.position.x+e});s=r?s-e:s+e;if(Math.abs(s)>=a)v()}function v(){var e;if(r){e=o.first();o.splice(0,1);o.push(e)}else{e=o.last();o.pop();o.splice(0,0,e)}s=r?s+a:s-a;e.sprite.position.x=r?o[o.length-2].sprite.position.x+a:o[1].sprite.position.x-a}this.endSpin=function(){i=false;var e=p;$({speed:0}).animate({speed:e},{duration:f*3,step:function(t){m(e-t)},complete:function(){S()}})};function S(){const e=Math.abs(s)>a/2;const t=s;const n=e?s>=0?a:a*-1:0;$({x:t}).animate({x:n},{duration:f*2,easing:"easeOutElastic",step:function(e){s=e;g()},complete:function(){if(e)v();if(d.finishedSpin)d.finishedSpin()}})}this.getResult=function(){return o[2]};return this}function Slot(e,t,n){this.type=e;const i=helper.getSlotTypeFileName(this.type);const r=backgroundHeight*.6333333;this.create=function(){var e=PIXI.loader.resources[i].texture;var o=new PIXI.Rectangle(0,n*(e.height/3),e.width,e.height/3);var s=new PIXI.Texture(e,o);this.sprite=new PIXI.Sprite(s);this.sprite.width=r;this.sprite.height=r/3;this.sprite.anchor.set(0,0);this.sprite.mask=t};return this}function SlotMachine(e){const t=[];const n=5;const i="images/machine.png";const r=300;const o=new GameResult;var s;var a=false;var c=0;this.onAllowStop;const u=this;this.create=function(){l();const e=p();h(e);f()};this.update=function(){$.each(t,function(e,t){t.spin()})};function l(){var e=new PIXI.Sprite(PIXI.loader.resources[i].texture);e.width=backgroundWidth;e.height=backgroundHeight;helper.addToScene(e)}function p(){var e=helper.createRoundSquare(47,0,backgroundWidth-47*2,430,40);e.position.y=110;helper.addToScene(e);return e}function h(i){for(var r=0;r<e;r++){var o=new Reel(n,r,i);o.create();t.push(o)}}function f(){t.last().readyToStop=function(){if(u.onAllowStop)u.onAllowStop()};t.last().finishedSpin=m}this.spin=function(e){if(a)return;c=0;s=e;a=true;$.each(t,function(e,t){d(t,e)})};function d(e,t){setTimeout(function(){e.startSpinning()},t*r)}this.stopSpin=function(){if(c==e)return;g(t[c++])};function g(e){e.endSpin()}function m(){const e=[];$.each(t,function(t,n){e.push(n.getResult())});a=false;s(o.calculateResult(e))}return this}
