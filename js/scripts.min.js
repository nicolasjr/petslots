function Facebook(){var t=this;this.init=function(){$.ajaxSetup({cache:true});$.getScript("//connect.facebook.net/en_US/sdk.js",function(){FB.init({appId:"1782765781940954",version:"v2.7"})})};this.requestPostScore=function(n,i){FB.getLoginStatus(function(o){if(o.status==="connected"){e(n,i)}else{t.login(function(){e(n,i)})}})};function e(t,e){var n="Hey! I just scored "+t+" points on PetSlot!";FB.api("/me/feed","post",{message:n,link:"http://nicolasjr.github.io/petslots",picture:"http://nicolasjr.github.io/petslots/images/machine.png",name:"My PetSlot Score!",description:"Post PetSlot Score on Wall."},function(t){if(e)e()})}this.login=function(t){FB.login(function(e){if(e.authResponse){t()}else{}},{scope:"publish_actions"})};return this}function Game(){const t=3;var e=new SlotMachine(t);var n=new GameUi;var i=false;var o=false;var s=0;var r=0;const a=100;var c=0;const u=9999999;this.init=function(){$.getJSON("json/images.json",function(t,e){const n=[];$.each(t.images,function(t,e){n.push(e)});PIXI.loader.add(n).on("progress",l).load(d)});container.appendChild(renderer.view)};function l(t){}function p(){if(i&&o){e.stopSpin();return}if(i)return;i=true;o=false;e.spin(f);n.toggleSpinButton()}function f(t){if(t){r++;var e=s+r*a;if(e>=u){e=u}S(e);n.showMultiplierLabel(r)}else if(s>0){function o(){S(0);r=0}function c(){facebook.requestPostScore(s)}n.gameOver(o,c)}i=false;n.toggleStop();n.toggleSpinButton()}function h(t){v(t);requestAnimationFrame(h);e.update();renderer.render(stage)}function d(){e.onAllowStop=g;e.onAllReelsStopped=m;e.create();n.create();n.onSpin=p;S(0);requestAnimationFrame(h)}function g(){o=true;n.toggleStop();n.toggleSpinButton()}function m(){n.toggleSpinButton()}function S(t){const e=s;s=t;if(!s)n.updateScoreLabelValue(s);else n.updateScoreLabel(e,t)}function v(t){currentTime=t;deltaTime=(currentTime-c)/1e3;c=currentTime}}function GameResult(){this.calculateResult=function(t){const e=t[0].type;for(var n=1;n<t.length;n++)if(t[n].type!==e)return false;return true}}const backgroundWidth=800;const backgroundHeight=600;const stage=new PIXI.Container,renderer=PIXI.autoDetectRenderer(backgroundWidth,backgroundHeight);const Slots=["cat","fox","dog","penguin","bear"];function Helper(){this.addToScene=function(t){stage.addChild(t)};this.addToParent=function(t,e){$(t).append(e)};this.removeFromScene=function(t){stage.removeChild(t)};this.createRoundSquare=function(t,e,n,i,o){var s=new PIXI.Graphics;s.beginFill();s.drawRoundedRect(t,e,n,i,o);s.endFill();return s};this.getSlotTypeFileName=function(t){return"images/"+t+".png"}}Array.prototype.contains=function(t){var e=this.length;while(e--)if(this[e]===t)return true;return false};Array.prototype.last=function(){return this[this.length-1]};Array.prototype.first=function(){return this[0]};PIXI.Graphics.prototype.setInteractive=function(t){this.interactive=t;return this};String.prototype.reverse=function(){return this.split("").reverse().join("")};function Reel(t,e,n){this.id=e;var i=false;var o=this.id%2==0;const s=[];var r=0;const a=300;const c=-90-a;const u=380/3;const l=155+this.id*u;var p=0;const f=2e3;const h=500;this.readyToStop;this.finishedSpin;const d=this;this.create=function(){for(var e=0;e<t;e++){var i=new Slot(Slots[e%Slots.length],n,this.id);i.create();s.push(i);helper.addToScene(i.sprite)}g()};function g(){$.each(s,function(t,e){e.sprite.position.y=l;e.sprite.position.x=r+c+t*a})}this.spin=function(){if(!i)return;m(p)};this.startSpinning=function(){i=true;var t=this;$({speed:0}).animate({speed:f},{duration:h,step:function(t){p=t},complete:function(){if(t.readyToStop!=null)t.readyToStop()}})};function m(t){const e=t*deltaTime;$.each(s,function(t,n){n.sprite.position.x=o?n.sprite.position.x-e:n.sprite.position.x+e});r=o?r-e:r+e;if(Math.abs(r)>=a)S()}function S(){var t;if(o){t=s.first();s.splice(0,1);s.push(t)}else{t=s.last();s.pop();s.splice(0,0,t)}r=o?r+a:r-a;t.sprite.position.x=o?s[s.length-2].sprite.position.x+a:s[1].sprite.position.x-a}this.endSpin=function(){i=false;var t=p;$({speed:0}).animate({speed:t},{duration:h*3,step:function(e){m(t-e)},complete:function(){v()}})};function v(){const t=Math.abs(r)>a/2;const e=r;const n=t?r>=0?a:a*-1:0;$({x:e}).animate({x:n},{duration:h*2,easing:"easeOutElastic",step:function(t){r=Math.round(t);g()},complete:function(){if(t)S();if(d.finishedSpin)d.finishedSpin()}})}this.getResult=function(){return s[2]};return this}function Slot(t,e,n){this.type=t;const i=helper.getSlotTypeFileName(this.type);const o=backgroundHeight*.6333333;this.create=function(){var t=PIXI.loader.resources[i].texture;var s=new PIXI.Rectangle(0,n*(t.height/3),t.width,t.height/3);var r=new PIXI.Texture(t,s);this.sprite=new PIXI.Sprite(r);this.sprite.width=o;this.sprite.height=o/3;this.sprite.anchor.set(0,0);this.sprite.mask=e};return this}function SlotMachine(t){const e=[];const n=5;const i="images/machine.png";const o=300;const s=new GameResult;var r;var a=false;var c=0;this.onAllowStop;this.onAllReelsStopped;const u=this;this.create=function(){l();const t=p();f(t);h()};this.update=function(){$.each(e,function(t,e){e.spin()})};function l(){var t=new PIXI.Sprite(PIXI.loader.resources[i].texture);t.width=backgroundWidth;t.height=backgroundHeight;helper.addToScene(t)}function p(){var t=helper.createRoundSquare(47,0,backgroundWidth-47.5*2,430,30);t.position.y=106;helper.addToScene(t);return t}function f(i){for(var o=0;o<t;o++){var s=new Reel(n,o,i);s.create();e.push(s)}}function h(){e.last().readyToStop=function(){if(u.onAllowStop)u.onAllowStop()};e.last().finishedSpin=m}this.spin=function(t){if(a)return;c=0;r=t;a=true;$.each(e,function(t,e){d(e,t)})};function d(t,e){setTimeout(function(){t.startSpinning()},e*o)}this.stopSpin=function(){if(c==t)return;g(e[c++]);if(c==t)this.onAllReelsStopped()};function g(t){t.endSpin()}function m(){const t=[];$.each(e,function(e,n){t.push(n.getResult())});a=false;r(s.calculateResult(t),t)}return this}function GameUi(){self.onSpin;self.onIncreaseCurrentBet;self.onDecreaseCurrentBet;var t=this;var e;var n;var i;var o;const s=GameOver();const r=".game-container";this.create=function(){c();a();u();l();s.create()};function a(){n=document.createElement("div");n.className="score-label";for(var t=0;t<7;t++){var e=document.createElement("div");e.className="entry";n.appendChild(e)}helper.addToParent(r,n)}function c(){i=document.createElement("button");i.className="spin-button";i.onclick=function(){t.onSpin()};helper.addToParent(r,i)}function u(){const t=document.createElement("div");t.className="logo";helper.addToParent(r,t)}function l(){e=document.createElement("div");e.className="multiplier";$(e).hide();helper.addToParent(r,e)}this.showMultiplierLabel=function(t){e.innerHTML="<p>"+t+"<span>x</span></p>";$(e).css("transform","scale(0, 0)");$(e).show();$({s:0}).animate({s:1},{duration:1e3,easing:"easeOutElastic",step:function(t){$(e).css("transform","scale("+t+", "+t+")")},complete:function(){setTimeout(function(){p()},1e3)}})};function p(){$({s:1}).animate({s:0},{duration:100,step:function(t){$(e).css("transform","scale("+t+", "+t+")")},complete:function(){$(e).hide()}})}this.toggleSpinButton=function(){i.disabled=!i.disabled};this.toggleStop=function(){$(i).toggleClass("spinning")};this.updateScoreLabel=function(e,n){$({s:e}).animate({s:n},{duration:1e3,step:function(e){t.updateScoreLabelValue(e.toFixed(0))}})};this.updateScoreLabelValue=function(t){const e=t.toString().reverse();const i=$(n).find(".entry");for(var o=0;o<i.length;o++){if(o<e.length){i[o].innerHTML=e[o]}else{i[o].innerHTML="0"}}};this.gameOver=function(t,e){s.showGameOverScreen(t,e)};return this}function GameOver(){var t;var e;var n;const i=".game-container";const o=100;this.create=function(){t=document.createElement("div");t.className="game-over";$(t).hide();var e=document.createElement("button");e.className="btn-restar";e.innerHTML="RESTART";e.onclick=s;var n=document.createElement("button");n.className="btn-share";n.innerHTML="SHARE";n.onclick=r;t.appendChild(n);t.appendChild(e);helper.addToParent(i,t)};function s(){if(!e)return;e();e=null;$(t).fadeOut(o)}function r(){if(n)n()}this.showGameOverScreen=function(i,s){e=i;n=s;$(t).fadeIn(o)};return this}
